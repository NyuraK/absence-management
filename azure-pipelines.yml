trigger:
- master

resources:
- repo: self

jobs:

- job: BuildImage
  displayName: Build

  pool:
    vmImage: 'ubuntu-latest'

  steps:
  - task: Maven@3
    displayName: 'Maven clean install'
    inputs:
      mavenPomFile: 'pom.xml' 
      goals: 'package' 

  - task: Docker@1
    displayName: 'Build and push an image'
    inputs:
      dockerFile: 'backend/Dockerfile'
      azureSubscriptionEndpoint: 'Azure for Students'
      azureContainerRegistry: 'absencemanagementacr'

  - script:
      dockerFile:build 
      dockerfile:push
      docker-compose -f backend/docker-compose.yml --project-directory . -p docs up -d